var VeGraph=function(t){var e=document.getElementById(t),n=e.getContext("2d"),s=90,a=50,o=100,r=50,l=50,h=[],c=[],f=[],d={drawn:!1},u={box:document.getElementById("box-nufarm-canvas"),percent:document.getElementById("percent-box-nufarm"),number:document.getElementById("number-box-nufarm")},g=[],v=[],P=[];this.color="rgba(0,0,0,0.5)";var b=function(t){t+="",x=t.split("."),x1=x[0],x2=x.length>1?","+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1.$2");return x1+x2};this.drawLine=function(t,e,i,i){rX=t+i,n.save(),n.beginPath(),n.setLineDash([4]),n.moveTo(t,this.Y(e)),n.lineTo(rX,this.Y(e)),n.stroke(),n.closePath()},this.setDataLine=function(t){try{if(t.labels.length!=t.data.length)throw"La cantidad de labels es distinta a la de los datos seteados.";this.setBackground(t.color),this.setPointersX(t.labels),this.setPointersY(t.data),this.setRealData(t.realData),this.setLines(),this.pointerInfo()}catch(e){console.error("Error",e)}},this.displayBox=function(t,e,i,n){u.box.style.display="block",u.box.style.top=e-50+"px",u.box.style.left=t-25+"px",u.number.innerHTML=b(n)||0,u.percent.innerHTML=i||0},this.hiddeBox=function(){u.box.style.display="none"},this.setRealData=function(t){for(i=0;i<t.length;i++)c.push(t[i])},this.setBackground=function(t){""!=t&&void 0!=t&&(this.color=t)},this.drawGraphLine=function(){var t=g.length;void 0==d.x||d.drawn||this.drawBoxAlert();for(var e=0;t>e;e++)this.drawPoints(g[e],v[e]),void 0!=v[e]&&void 0!=g[e]&&h.push({position:{x:g[e],y:v[e]}})},this.drawBoxAlert=function(){var t="SUPERA PORCENTAJE DE FACTURACION TOTAL PERIODO ANTERIOR",i=this.Y(s+2*l);if(n.save(),n.beginPath(),n.fillStyle="rgba(234,234,234,0.6)",n.shadowBlur=5,n.shadowColor="rgba(238,238,238,0.5)",n.fillRect(d.x,i-30,324,23),n.closePath(),n.restore(),n.save(),n.beginPath(),n.fillStyle="rgba(91,91,91,0.1)",n.fillRect(o,i,e.width,2*l),n.closePath(),n.restore(),n.save(),n.beginPath(),n.moveTo(d.x,d.y-l),n.font="9px sans-serif",n.fillStyle="#565756",n.fillText(t,d.x+10,i-15),n.closePath(),16==c.length){var a=f[f.length-1],r=c[c.length/2-1];console.info("Reporting realValueOnPosition:",c),console.info("Reporting realValuePercentPosition:",f);var h=g[g.length-1],u=b(r),x=a+"%",v=n.measureText(u).width,P=n.measureText(x).width;n.save(),n.beginPath(),n.font="bold 12px sans-serif",n.fillStyle="#000000",n.fillText(u,h-v/2,this.Y(s)+20),n.fillText(x,h-P/2,this.Y(s)+35),n.closePath()}this.drawReference("P.TOTAL",0,.5),this.drawReference("P.CLAVE",100,1)},this.drawReference=function(t,e,i){n.save(),n.beginPath(),n.fillStyle="rgba(141,42,144,"+i+")",n.arc(o+e,this.Y(s)+50,10,0,2*Math.PI,!1),n.closePath(),n.fill(),n.beginPath(),n.font="bold 11px sans-serif",n.fillStyle="#666666",n.fillText(t,o+20+e,this.Y(s)+55),n.closePath(),n.fill()},this.reset=function(){n.clearRect(0,0,e.width,e.height)},this.pointerInfo=function(){elem=document.getElementById("area");var t=this.getPointerInfo,i={y:this.Y,d:this.displayBox,h:this.hiddeBox};e.onmousemove=function(e){var n={canvas:e.offsetX,real:e.clientX},s={canvas:e.offsetY,real:e.clientY};t(n,s,i),elem.innerHTML="CLIENT X "+n.real+"; CLIENT Y "+s.real},e.onclick=function(){i.h()}},this.getPointerInfo=function(t,e,n){for(i=0;i<h.length;i++){var s=n.y(h[i].position.y),a=h[i].position.x,o=t.canvas+5>=a&&t.canvas<=a+5,r=e.canvas+5>=s&&e.canvas<=s+5;o&&r&&n.d(t.real,e.real,f[i]+"%",c[i])}},this.setPointersX=function(t){for(var t=t.length,i=e.width-o-r,n=i/t,s=1;t+1>s;s++)g.push(s*n+n)},this.setPointersY=function(t){v=[];for(var e=0;e<t.length;e++){f.push(t[e]);var i=t[e]+s;v.push(i)}},this.setLines=function(){for(P.push({moveToX:o,moveToY:this.Y()}),n.restore(),n.beginPath(),n.moveTo(o,this.Y(90)),n.setLineDash([]),n.lineTo(g[0],this.Y(v[0])),i=0;i<g.length;i++)void 0!=g[i+1]&&n.lineTo(g[i+1],this.Y(v[i+1]));var t=v[v.length-1];n.lineTo(e.width,this.Y(t)),n.lineTo(e.width,this.Y(s)),n.closePath(),n.fillStyle=this.color,n.fill()},this.drawPoints=function(t,e){n.save(),n.beginPath(),n.fillStyle="#5B5B5B",n.arc(t,this.Y(e),5,0,2*Math.PI),n.fill()},this.drawTextPercentages=function(t,e){var i=14,s=n.measureText(e).width,a=o/2-s,r=t-3.3,l=function(t){return"100%"==t?"bold ":""};console.log(e),n.save(),n.beginPath(),n.font=l(e)+i+"px sans-serif",n.fillText(e,a+35,this.Y(r)),n.closePath()},this.setPercentages=function(t){var i=Math.ceil(t/l);e.height=i*l+s+a,this.drawLine(o,90,0,e.width),this.drawTextPercentages(90,0);for(var n=1;i+1>n;n++){var r=n*l+s;this.drawLine(o,r,0,e.width),t>=100&&(d.x=o,d.y=r),this.drawTextPercentages(r,this.textPercentage(n))}},this.textPercentage=function(t){var e=50*t;return e+"%"},this.Y=function(t){return Math.abs(t-e.height)}};